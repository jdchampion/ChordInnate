-- TODO: drop table and remove this script if not used
PRAGMA FOREIGN_KEYS = ON;
DROP TABLE IF EXISTS TBL_INTERVALS_REF;

CREATE TABLE IF NOT EXISTS TBL_INTERVALS_REF (
  ID INTEGER PRIMARY KEY AUTOINCREMENT,
  QUALITY_SYMBOL INTEGER NOT NULL CHECK (QUALITY_SYMBOL > 0),
  COMPOUND_DIATONIC INTEGER NOT NULL CHECK (COMPOUND_DIATONIC > 0),
  SEMITONES INTEGER NOT NULL CHECK (SEMITONES >= 0),
  OCTAVES INTEGER,                        -- set by trigger
  SIMPLE_DIATONIC INTEGER,                -- set by trigger
  FOREIGN KEY (QUALITY_SYMBOL) REFERENCES TBL_INTERVAL_QUALITIES (ID),
  FOREIGN KEY (SIMPLE_DIATONIC) REFERENCES DEGREES (ID)
);

-- Automatically set the base number and octaves
DROP TRIGGER IF EXISTS TRIG_IR_BASE_NUMBER;
CREATE TRIGGER TRIG_IR_BASE_NUMBER AFTER INSERT ON TBL_INTERVALS_REF
BEGIN
  UPDATE TBL_INTERVALS_REF
  SET SIMPLE_DIATONIC =
    CASE
      WHEN COMPOUND_DIATONIC > 7 THEN
        (CASE WHEN (COMPOUND_DIATONIC % 7) = 0 THEN 1
        ELSE (COMPOUND_DIATONIC % 7) END)
      ELSE COMPOUND_DIATONIC
    END
  WHERE _ROWID_ = LAST_INSERT_ROWID();
  UPDATE TBL_INTERVALS_REF
  SET OCTAVES = SEMITONES / 12
  WHERE _ROWID_ = LAST_INSERT_ROWID();
END;

INSERT INTO TBL_INTERVALS_REF (QUALITY_SYMBOL, COMPOUND_DIATONIC, SEMITONES) VALUES
  (3, 1, 0),
  (5, 1, 1),
  (4, 2, 0),
  (2, 2, 1),
  (1, 2, 2),
  (5, 2, 3),
  (4, 3, 2),
  (2, 3, 3),
  (1, 3, 4),
  (5, 3, 5),
  (4, 4, 4),
  (3, 4, 5),
  (5, 4, 6),
  (4, 5, 6),
  (3, 5, 7),
  (5, 5, 8),
  (4, 6, 7),
  (2, 6, 8),
  (1, 6, 9),
  (5, 6, 10),
  (4, 7, 9),
  (2, 7, 10),
  (1, 7, 11),
  (5, 7, 12),
  (4, 8, 11),
  (3, 8, 12),

  (5, 8, 13),
  (4, 9, 12),
  (2, 9, 13),
  (1, 9, 14),
  (5, 9, 15),
  (4, 10, 14),
  (2, 10, 15),
  (1, 10, 16),
  (5, 10, 17),
  (4, 11, 16),
  (3, 11, 17),
  (5, 11, 18),
  (4, 12, 18),
  (3, 12, 19),
  (5, 12, 20),
  (4, 13, 19),
  (2, 13, 20),
  (1, 13, 21),
  (5, 13, 22),
  (4, 14, 21),
  (2, 14, 22),
  (1, 14, 23),
  (5, 14, 24),
  (4, 15, 23),
  (3, 15, 24),

  (5, 15, 25),
  (4, 16, 24),
  (2, 16, 25),
  (1, 16, 26),
  (5, 16, 27),
  (4, 17, 26),
  (2, 17, 27),
  (1, 17, 28),
  (5, 17, 29),
  (4, 18, 28),
  (3, 18, 29),
  (5, 18, 30),
  (4, 19, 30),
  (3, 19, 31),
  (5, 19, 32),
  (4, 20, 31),
  (2, 20, 32),
  (1, 20, 33),
  (5, 20, 34),
  (4, 21, 33),
  (2, 21, 34),
  (1, 21, 35),
  (5, 21, 36),
  (4, 22, 35),
  (3, 22, 36),

  (5, 22, 37),
  (4, 23, 36),
  (2, 23, 37),
  (1, 23, 38),
  (5, 23, 39),
  (4, 24, 38),
  (2, 24, 39),
  (1, 24, 40),
  (5, 24, 41),
  (4, 25, 40),
  (3, 25, 41),
  (5, 25, 42),
  (4, 26, 42),
  (3, 26, 43),
  (5, 26, 44),
  (4, 27, 43),
  (2, 27, 44),
  (1, 27, 45),
  (5, 27, 46),
  (4, 28, 45),
  (2, 28, 46),
  (1, 28, 47),
  (5, 28, 48),
  (4, 29, 47),
  (3, 29, 48),

  (5, 29, 49),
  (4, 30, 48),
  (2, 30, 49),
  (1, 30, 50),
  (5, 30, 51),
  (4, 31, 50),
  (2, 31, 51),
  (1, 31, 52),
  (5, 31, 53),
  (4, 32, 52),
  (3, 32, 53),
  (5, 32, 54),
  (4, 33, 54),
  (3, 33, 55),
  (5, 33, 56),
  (4, 34, 55),
  (2, 34, 56),
  (1, 34, 57),
  (5, 34, 58),
  (4, 35, 57),
  (2, 35, 58),
  (1, 35, 59),
  (5, 35, 60),
  (4, 36, 59),
  (3, 36, 60),

  (5, 36, 61),
  (4, 37, 60),
  (2, 37, 61),
  (1, 37, 62),
  (5, 37, 63),
  (4, 38, 62),
  (2, 38, 63),
  (1, 38, 64),
  (5, 38, 65),
  (4, 39, 64),
  (3, 39, 65),
  (5, 39, 66),
  (4, 40, 66),
  (3, 40, 67),
  (5, 40, 68),
  (4, 41, 67),
  (2, 41, 68),
  (1, 41, 69),
  (5, 41, 70),
  (4, 42, 69),
  (2, 42, 70),
  (1, 42, 71),
  (5, 42, 72),
  (4, 43, 71),
  (3, 43, 72),

  (5, 43, 73),
  (4, 44, 72),
  (2, 44, 73),
  (1, 44, 74),
  (5, 44, 75),
  (4, 45, 74),
  (2, 45, 75),
  (1, 45, 76),
  (5, 45, 77),
  (4, 46, 76),
  (3, 46, 77),
  (5, 46, 78),
  (4, 47, 78),
  (3, 47, 79),
  (5, 47, 80),
  (4, 48, 79),
  (2, 48, 80),
  (1, 48, 81),
  (5, 48, 82),
  (4, 49, 81),
  (2, 49, 82),
  (1, 49, 83),
  (5, 49, 84),
  (4, 50, 83),
  (3, 50, 84),

  (5, 50, 85),
  (4, 51, 84),
  (2, 51, 85),
  (1, 51, 86),
  (5, 51, 87),
  (4, 52, 86),
  (2, 52, 87),
  (1, 52, 88),
  (5, 52, 89),
  (4, 53, 88),
  (3, 53, 89),
  (5, 53, 90),
  (4, 54, 90),
  (3, 54, 91),
  (5, 54, 92),
  (4, 55, 91),
  (2, 55, 92),
  (1, 55, 93),
  (5, 55, 94),
  (4, 56, 93),
  (2, 56, 94),
  (1, 56, 95),
  (5, 56, 96),
  (4, 57, 95),
  (3, 57, 96),

  (5, 57, 97),
  (4, 58, 96),
  (2, 58, 97),
  (1, 58, 98),
  (5, 58, 99),
  (4, 59, 98),
  (2, 59, 99),
  (1, 59, 100),
  (5, 59, 101),
  (4, 60, 100),
  (3, 60, 101),
  (5, 60, 102),
  (4, 61, 102),
  (3, 61, 103),
  (5, 61, 104),
  (4, 62, 103),
  (2, 62, 104),
  (1, 62, 105),
  (5, 62, 106),
  (4, 63, 105),
  (2, 63, 106),
  (1, 63, 107),
  (5, 63, 108),
  (4, 64, 107),
  (3, 64, 108),

  (5, 64, 109),
  (4, 65, 108),
  (2, 65, 109),
  (1, 65, 110),
  (5, 65, 111),
  (4, 66, 110),
  (2, 66, 111),
  (1, 66, 112),
  (5, 66, 113),
  (4, 67, 112),
  (3, 67, 113),
  (5, 67, 114),
  (4, 68, 114),
  (3, 68, 115),
  (5, 68, 116),
  (4, 69, 115),
  (2, 69, 116),
  (1, 69, 117),
  (5, 69, 118),
  (4, 70, 117),
  (2, 70, 118),
  (1, 70, 119),
  (5, 70, 120),
  (4, 71, 119),
  (3, 71, 120),

  (5, 71, 121),
  (4, 72, 120),
  (2, 72, 121),
  (1, 72, 122),
  (5, 72, 123),
  (4, 73, 122),
  (2, 73, 123),
  (1, 73, 124),
  (5, 73, 125),
  (4, 74, 124),
  (3, 74, 125),
  (5, 74, 126),
  (4, 75, 126),
  (3, 75, 127),
  (5, 75, 128),
  (4, 76, 127),
  (2, 76, 128),
  (1, 76, 129),
  (5, 76, 130),
  (4, 77, 129),
  (2, 77, 130),
  (1, 77, 131),
  (5, 77, 132),
  (4, 78, 131),
  (3, 78, 132);